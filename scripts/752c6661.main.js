var utils=function(){"use strict";var a=function(a,b,c,d,e){a.line(b,c,d,e)},b=function(a,b,c){a.ellipse(b,c,2,2)},c=function(a,b){var c;for(c in a)a[c]=b[c]||a[c];return a};return{d1:a,d2:b,merge:c}}(),app=app||{},MAX_POINTS=1e3;app.gmlEditor=function(){var a,b,c,d,a,b,e=[],f=-1,g=function(c,d){var g=new Date;-1===f&&(f=g);var h=g-f;e.push({x:c/a,y:d/b,z:0,t:h}),$("#m-pointcount").css("width",e.length/MAX_POINTS*$("#draw-input").width())},h=function(a){e.forEach(function(b){b.t=b.t/(a-f)})},i=function(c){function d(){c.size(a,b),c.background(245,246,243),c.stroke(0),console.log("setting up")}function f(){m(),c.fill(0),g(c.mouseX,c.mouseY),console.log(e)}function i(){e.length>=MAX_POINTS||(c.fill(0),c.stroke(0),g(c.mouseX,c.mouseY),1!==e.length&&c.line(e[e.length-1].x*(a-1),e[e.length-1].y*(b-1),e[e.length-2].x*(a-1),e[e.length-2].y*(b-1)))}function j(){var a=new Date;h(a)}c.setup=d,c.mousePressed=f,c.mouseDragged=i,c.mouseReleased=j},j=function(){var a=new X2JS,b={};b={tag:{drawing:{stroke:{pt:[]}}}},e.forEach(function(a){b.tag.drawing.stroke.pt.push(a)});{var c='<gml spec="1.0">'+a.json2xml_str(b)+"</gml>";({gml:c,time:Date.now()})}return c},k=function(){},l=function(e,f,g,h){var j=document.getElementById(e);if(j){c=$("canvas")[0],a=$("canvas").width(),b=$("canvas").height(),a=g||500,b=h||500,d=f||k;{new Processing(c,i)}}},m=function(){e=[],f=-1;var d=c.getContext("2d");d.fillStyle="rgb(245,246,243)",d.fillRect(0,0,a,b)},n=function(){return e};return{init:l,getGML:j,clear:m,getPoints:n}}(),app.renderer=function(){"use strict";var a=0,b=function(b,c){var d=b,e=x2js.xml_str2json(d.pts).gml;if(0===e.tag.drawing.stroke.pt.length){var f=_.template($("#text-card-template").html());$("#cards").append(f({text:d.text}))}else{a+=1;var g=[240,240,240],h=[3];11===a&&(g=[60,169,183],h=[255],a=0),4===a&&(h=[240,240,240],g=[40,45,50]);var i=new GmlCanvas("cards",{width:c,height:c,drawingFun:utils.d1,backgroundColor:g,strokeColor:h});i.render(e,9e3)}};return{render:b}}();var app=app||{};app.form=function(){"use strict";var a=function(){app.gmlEditor.init("draw-input",550,550),d()},b=function(){var a=e(),b=f(a,function(){});b?c(a):!1},c=function(a){var b,c=JSON.stringify(a),d="data:application/octet-stream;base64,"+Base64.encode(c);b=document.getElementById("hiddenDownloader"),null===b&&(b=document.createElement("iframe"),b.id="hiddenDownloader",b.style.display="none",document.body.appendChild(b)),b.src=d},d=function(){$(".erase").on("click",function(){app.gmlEditor.clear()}),$(".submit").on("click",function(){b(),app.gmlEditor.clear()})},e=function(){var a=$("#m-textarea").val(),b=(app.gmlEditor.getPoints(),{text:a||"",pts:app.gmlEditor.getGML()}),c={age:"#m-age",name:"#m-name",country:"#m-country"};for(var d in c)b[d]=$(c[d]).val();return b},f=function(a){return console.log(a),a.text||0!==app.gmlEditor.getPoints().length?!0:!1},g=function(a){return console.log("uploading"),a&&(a.time=Date.now(),console.log("saving "+JSON.stringify(a)),$.ajax({type:"POST",url:"http://54.68.129.229",crossDomain:!0,data:JSON.stringify(a),dataType:"json",success:function(a){a.someKey},error:function(){console.log("POST failed.")}})),!1};return{init:a,upload:g}},function(){var a=new app.form($("#moon-form"));a.init()}();